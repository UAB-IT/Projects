<html>
  <body>


    <style>
      .occupancy-card {
        display: flex;
        align-items: center;
      }
      .occupancy-card .status {
        height: 125px;
        width: 125px;
        background-color: #B3B4B6;
        margin-right: 1.6rem;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .occupancy-card .status img {
        width: 50px;
      }
    </style>


    <!-------------------------------------------------------------------------
    Each building occupancy tracker should have the following HTML
    * The .occupancy-card ID should be that building's space code
      See SenSource API documentation for more about space codes
    * Remember to adjust the header size in this component as needed.
    -------------------------------------------------------------------------->

    <div id="2f9cd911" class="occupancy-card">
      <div class="status">
      </div>
      <div>
        <h3>Hill Student Center</h3>
        <p class="uk-h4"><span class="percent"></span>%</p>
        <p><span class="curr-occ"></span> / <span class="max-cap"></span> Occupancy</p>
      </div>
    </div>


    <script type="text/javascript">

    /* ------------------------------------------------------------------------
    Configuration
    Use the safeStudyIcons object to assign the icons and colors for the status
    indicator.
    ------------------------------------------------------------------------ */
    const safeStudyIcons = {
      good: '<img src="/it/home/images/01icons/icon-check.png" alt="Available Space">',
      goodColor: '#CCE499',
      caution: '<img src="/it/home/images/01icons/icon-caution.png" alt="Nearing Capacity">',
      cautionColor: '#FFEE99',
      full: '<img src="/it/home/images/01icons/icon-cancel.png" alt="At Capacity">',
      fullColor: '#B3B4B6'
    }


    function safeStudy(spaceCode) {
      const baseUrl = `https://display.safespace.io`;
      const parent = document.getElementById(spaceCode);

      /* Get all input elements */
      const container = {
        currOcc: parent.querySelector(`.curr-occ`),
        maxCap: parent.querySelector(`.max-cap`),
        percent: parent.querySelector(`.percent`),
        status: parent.querySelector(`.status`)
      }

      /* Initilize variables to be set later, ensures proper scope */
      let occupancy = 0;
      let capacity = 0;
      let percent = 0;

      /* Start Promise */
      Promise.all([
        /* Fetch the occupancy value */
        fetch(`${baseUrl}/value/live/${spaceCode}`)
          .then((response) => response.text())
          .then((val) => occupancy = +val),

        /* Fetch the capacity value */
        fetch(`${baseUrl}/entity/space/hash/${spaceCode}`)
          .then((response) => response.json())
          .then((body) => capacity = +body.space.maxCapacity),

      ]).then(() => {
        /* Add the occupancy and capacity text to their containers */
        container.currOcc.textContent = occupancy;
        container.maxCap.textContent = capacity;
        /* Calculate thee percentage full */
        percent = Math.floor((occupancy / capacity) * 100);
        container.percent.textContent = percent;

        /* Use good status if percentage is less than 75
           Caution status if greater than 75 but less than 100
           Full status if equal to 100 */
        if (percent < 75) {
          container.status.innerHTML = safeStudyIcons.good;
          container.status.style.backgroundColor = safeStudyIcons.goodColor;
        } else if (percent < 100) {
          container.status.innerHTML = safeStudyIcons.caution;
          container.status.style.backgroundColor = safeStudyIcons.cautionColor;
        } else {
          container.status.innerHTML = safeStudyIcons.full;
          container.status.style.backgroundColor = safeStudyIcons.fullColor;
        }
      }).then(() => {
        /* Rerun the function every 10 seconds to get live data */
        setTimeout(safeStudy, 10000, spaceCode);
      });
    }

    /* Call the function with the space code / ID of container */
    safeStudy('2f9cd911');

    </script>
  </body>
</html>
